<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Oceanograhic LLM</title>
  <style>
    @font-face {
      font-family: 'Vanlose_Booktype';
      src: url('vanlose_booktype_normal.otf') format('opentype');
      font-weight: normal;
      font-style: normal;
    }
	
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      font-family: 'Vanlose_Booktype';
    }

    video#bg-video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: fill;
      z-index: -1;
    }

    .centered-layout {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      text-align: center;
    }   

    .content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-45%, -50%);
      background-color: rgba(255, 255, 255, 0);
      color: white;
      padding: 0.25rem;
      border-radius: 5px;
      text-align: center;
    }

   .content h1 {
      font-size: 3.5rem; 
      margin-bottom: 0.5rem;
    }

    .input-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 0 auto;
    }

    .input-wrapper input[type="text"] {
      width: 45ch;
      padding: 10px 50px 10px 15px; /* room for button inside box */
      font-size: 16px;
      border: none;
      border-radius: 5px;
      color: white;
      outline: none;
      box-sizing: border-box;
      font-family: 'Vanlose_Booktype';
      background-color: rgba(255, 255, 255, 0.2); 
    }

    .input-wrapper input::placeholder {
      color: white;
      opacity: 1; /* required in some browsers like Firefox */
    }

    .input-wrapper button {
      position: relative;
      padding: 6px 12px;
      font-size: 16px;
      color: white;
      background-color: rgba(225, 225, 255, 0.3);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-left: -2.5rem;
      height: 80%;
    }

    #response {
      margin-top: 1rem;
      font-style: italic;
    }
  </style>
</head>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const initialContent = document.getElementById("initial-content");
    const expandedContainer = document.getElementById("expanded-container");
    const userInput = document.getElementById("userInput");
    const secondInput = document.getElementById("secondInput");
    const boxPlaceholder = document.getElementById("box-placeholder");

    let initialized = false;

    function createNewBox() {
      const box = document.createElement("div");
      box.className = "big-box";
      box.style.opacity = 0;
      box.style.transition = "opacity 0.5s ease";
      box.innerHTML = `
        <div style=" background-color: rgba(255, 255, 255, 0.2); padding: 2rem; border-radius: 10px; 
        width: 600px; height: 200px; overflow-y: auto; overflow-x: hidden; margin: 0 auto; 
        box-sizing: border-box;">
      <p style="font-size: 1.25rem; color: white; word-wrap: break-word; margin: 0; text-align: left;">
      </p>
    </div>
`   ;
      return box;
    }

    function transitionToExpanded() {
      if (!initialized) {
        initialContent.style.transition = "opacity 0.5s ease";
        initialContent.style.opacity = 0;
        setTimeout(() => {
          initialContent.style.display = "none";
          expandedContainer.style.display = "block";
          setTimeout(() => {
            expandedContainer.style.transition = "opacity 0.5s ease";
            expandedContainer.style.opacity = 1;
            initialized = true;
            swapBox(); // show first bigger box
          }, 50);
        }, 500);
      } else {
        swapBox();
      }
    }

    function swapBox() {
      const oldBox = boxPlaceholder.firstChild;
      const newBox = createNewBox();

      const input = secondInput.value || userInput.value; 
      const apiUrl = "https://1ce2-13-58-18-14.ngrok-free.app/ask";       

      // Handle box swapping
      if (oldBox) {
        oldBox.style.opacity = 0;
        setTimeout(() => {
          boxPlaceholder.removeChild(oldBox);
          boxPlaceholder.appendChild(newBox);
          requestAnimationFrame(() => {
            newBox.style.opacity = 1;
          });
        }, 500);
      } else {
        boxPlaceholder.appendChild(newBox);
        requestAnimationFrame(() => {
          newBox.style.opacity = 1;
        });
      }

      // Reset input field
      secondInput.value = "";
      secondInput.placeholder = "What else can I help you with?";

      // Optional: show loading while waiting
      const p = newBox.querySelector("p");
      if (p) {
        p.textContent = "Thinking...";
      }

      // Send API request
      fetch(apiUrl, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ query_string: input })
      })
        .then(response => {
          if (!response.ok) {
            throw new Error("HTTP error " + response.status);
          }
          return response.json();
        })
        .then(data => {
          const responseText = data.results || "No response received.";
          if (p) {
            p.textContent = responseText;
          }
        })
        .catch(error => {
          console.error("API error:", error);
          if (p) {
           p.textContent = "There was an error connecting to the server.";
          }
        });
    }

    userInput.addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        transitionToExpanded();
      }
    });

    secondInput.addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        swapBox();
      }
    });

    // Expose for inline onclick
    window.transitionToExpanded = transitionToExpanded;
    window.swapBox = swapBox;
  });
</script>

<body>
  <video id="bg-video" autoplay muted loop playsinline>
    <source src="AdobeStock.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <div id="initial-content" class="content">
    <h1>Let's explore together...</h1>
    <div class="input-wrapper">
      <input type="text" id="userInput" placeholder="Ask me about our oceans." />
      <button onclick="transitionToExpanded()">➤</button>
    </div>
  </div>

  <div id="expanded-container" class="centered-layout" style="display: none; opacity: 0;">
    <div id="box-placeholder"></div>
    <div class="input-wrapper" style="margin-top: 2rem; margin-bottom:0.5rem;">
      <input type="text" id="secondInput" placeholder="What else can I help you with?" />
      <button onclick="swapBox()">➤</button>
    </div>
  </div>

  <div style="position: fixed; bottom: 10px; right: 20px; color: white; font-family: 'Vanlose_Booktype'; font-size: 1.2rem; opacity: 0.7;">DEMO VERSION</div>

</body>

</html>